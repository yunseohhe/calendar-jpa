# 📖 **주특기 숙련 주차 개인과제**

## 🗓️ **JPA를 활용한 upgrade 일정 관리 앱 서버 만들기**


### 🔥 목표
1. JPA를 활용하여 CRUD를 구현하고, 객제 지향적으로 데이터를 다룰 수 있다.
2. JPA를 활용하여 데이터베이스를 관리하고 영속성에 대해서 이해할 수 있다.


### 🔥 공통 조건

- 모든 테이블은 고유 식별자(ID)를 가집니다.
- `3 Layer Architecture` 에 따라 각 Layer의 목적에 맞게 개발합니다.
- CRUD 필수 기능은 모두 데이터베이스 연결 및  `JPA`를 사용해서 개발합니다.
- `JDBC`와 `Spring Security`는 사용하지 않습니다.
- 인증/인가 절차는 `JWT`를 활용하여 개발합니다.
- JPA의 연관관계는 `양방향`으로 구현합니다.


# 📖 **API 설계**



# 📖 **ERD 작성**







# **💡 필수 구현 단계 - JPA를 활용한 CRUD 심화**

## 🔥 0단계

과제의 첫걸음

### 작성

1. API 명세서 작성하기
    1. API명세서는 프로젝트 root(최상위) 경로의 `README.md` 에 작성하세요.

1. ERD 작성하기
    1. ERD는 프로젝트 root(최상위) 경로의 `README.md` 에 첨부하세요.

1. SQL 작성하기
    1. 설치한 데이터베이스(MySQL)에 ERD를 따라 테이블을 만드세요.
    - 참고) SQL 작성 가이드
        - 과제 프로그램의 root(최상위) 경로에 `.sql` 파일을 만들고, 테이블 생성에 필요한 query를 작성하세요.


## 🔥 1단계

기능: 일정 CRU
학습목표: JPA 입문

### 조건

1. 일정을 저장, 단건 조회, 수정할 수 있습니다.
2. 일정은 `작성 유저명`, `할일 제목`, `할일 내용`, `작성일`, `수정일` 필드를 갖고 있습니다.

## 🔥 2단계

기능: 댓글 CRUD
학습목표: 연관관계 기본

### 조건

1. 일정에 댓글을 달 수 있습니다.
    1. 댓글과 일정은 연관관계를 가집니다.
2. 댓글을 저장, 단건 조회, 전체 조회, 수정, 삭제할 수 있습니다.
3. 댓글은 `댓글 내용`, `작성일`, `수정일`, `작성 유저명` 필드를 갖고 있습니다.

## 🔥 3단계

기능: 일정 페이징 조회
학습목표: 페이징/정렬

### 조건

1. 일정을 Spring Data JPA의 `Pageable`과 `Page` 인터페이스를 활용하여 페이지네이션을 구현해주세요.
    1. `페이지 번호`와 `페이지 크기`를 쿼리 파라미터로 전달하여 요청하는 항목을 나타냅니다.
    2. `할일 제목`, `할일 내용`, `댓글 개수`, `일정 작성일`, `일정 수정일`, `일정 작성 유저명` 필드를 조회합니다.
    3. 디폴트 `페이지 크기`는 10으로 적용합니다.
2. 일정의 `수정일`을 기준으로 내림차순 정렬합니다.

## 🔥 4단계

기능: 일정 삭제
학습목표: 영속성 전이

### 조건

1. 일정을 삭제할 때 일정의 댓글도 함께 삭제됩니다.
    1. JPA의 영속성 전이 기능을 활용합니다.


## 🔥 5단계

기능: 유저 CRUD
학습목표: 연관관계 심화

### 조건

1. 유저를 저장, 단건 조회, 전체 조회, 삭제할 수 있습니다.
    1. 유저는 `유저명`, `이메일`, `작성일`, `수정일` 필드를 갖고 있습니다.
2. 일정은 이제 `작성 유저명` 필드 대신 `유저 고유 식별자` 필드를 가집니다.
3. 일정을 작성한 유저는 추가로 일정 담당 유저들을 배치할 수 있습니다.
    1. 유저와 일정은 N:M 관계입니다. (`@ManyToMany` 사용 금지!)


## 🔥 6단계

기능: 일정 조회 개선
학습목표: 지연 로딩

### 조건

1. 일정 단건 조회 시 담당 유저들의 `고유 식별자`, `유저명`, `이메일`이 추가로 포함됩니다.
2. 일정 전체 조회 시 담당 유저 정보가 포함되지 않습니다.
    1. JPA의 지연 로딩 기능을 활용합니다.



# 💡 **추가 구현 단계 - JWT를 활용한 로그인/회원가입** #


## 🔥 7단계

기능: 회원가입
학습목표: JWT

### 조건

1. 유저에 `비밀번호` 필드를 추가합니다.
    1. 비밀번호는 암호화되어야 합니다.
    2. 암호화를 위한 `PasswordEncoder`를 직접 만들어 사용합니다.
        - 참고 코드
            1. `build.gradle` 에 아래의 의존성을 추가해주세요.

                ```java
                implementation 'at.favre.lib:bcrypt:0.10.2'
                ```

            2. `config` 패키지가 없다면 추가하고, 아래의 클래스를 추가해주세요.

                ```java
                import at.favre.lib.crypto.bcrypt.BCrypt;
                import org.springframework.stereotype.Component;
                
                @Component
                public class PasswordEncoder {
                
                    public String encode(String rawPassword) {
                        return BCrypt.withDefaults().hashToString(BCrypt.MIN_COST, rawPassword.toCharArray());
                    }
                
                    public boolean matches(String rawPassword, String encodedPassword) {
                        BCrypt.Result result = BCrypt.verifyer().verify(rawPassword.toCharArray(), encodedPassword);
                        return result.verified;
                    }
                }
                ```

2. 유저 최초 생성(회원가입) 시 JWT를 발급 후 반환합니다.

## 🔥 8단계

기능: 로그인
학습목표: 인증

### 설명

1. JWT를 활용해 로그인 기능을 구현합니다.
2. 필터를 활용해 인증 처리를 할 수 있습니다.

### 조건

1. `이메일`과 `비밀번호`를 활용해 로그인 기능을 구현합니다.
    1. 로그인 성공 시 JWT  발급 후 반환합니다.
2. 모든 요청에서 토큰을 활용하여 인증 처리를 합니다.
    1. 토큰은 `Header`에 추가합니다.
3. 회원가입과 로그인은 인증 처리에서 제외합니다.

### ⚠️ 예외 처리

- 로그인 시 이메일과 비밀번호가 일치하지 않을 경우 401을 반환합니다.
- 토큰이 없는 경우 400을 반환합니다.
- 유효 기간이 만료된 토큰의 경우 401을 반환합니다.

## 🔥 9단계

기능: 권한 확인
학습목표: 인가

### 조건

1. 유저에 `권한`을 추가합니다.
    1. 권한은 `관리자`, `일반 사용자` 두 가지가 존재합니다.
    2. JWT를 발급할 때 유저의 권한 정보를 함께 넣어줍니다.
2. 일정 수정 및 삭제는 `관리자` 권한이 있는 유저만 할 수 있습니다.

### ⚠️ 예외 처리

- 권한이 없는 유저의 경우 403을 반환합니다.

## 🔥 10단계

기능: 외부 API 조회
학습목표: RestTemplate

### 조건

1. [**날씨 정보 데이터(링크)**](https://f-api.github.io/f-api/weather.json) API를 활용하여 오늘의 날씨를 조회할 수 있습니다.
    1. `RestTemplate`을 사용해 날씨를 조회합니다.
2. 일정에 `날씨` 필드를 추가합니다.
    1. 일정 생성 시에 날씨 정보를 생성일 기준으로 저장할 수 있습니다.